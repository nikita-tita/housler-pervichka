# ТЗ для мануального тестирования: Housler Первичка

**Версия:** 1.0
**Дата:** 01.12.2025
**URL:** https://agent.housler.ru

---

## 1. Подготовка к тестированию

### 1.1 Тестовые аккаунты

**Готовые тестовые аккаунты с постоянными кодами:**

| Email | Код | Роль | Описание |
|-------|-----|------|----------|
| `client@test.housler.ru` | `111111` | client | Обычный клиент |
| `client2@test.housler.ru` | `222222` | client | Второй клиент |
| `agent@test.housler.ru` | `333333` | agent | Агент (Housler) |
| `agent2@test.housler.ru` | `444444` | agent | Второй агент |
| `agency_admin@test.housler.ru` | `555555` | agency_admin | Админ агентства |
| `admin@test.housler.ru` | `666666` | admin | Администратор |

### 1.2 Процедура входа в тестовый аккаунт

**Пошаговая инструкция:**

1. Открыть https://agent.housler.ru/login
2. Ввести email тестового аккаунта (например: `client@test.housler.ru`)
3. **ВАЖНО:** Появится ссылка **"У меня есть постоянный код"** — нажать на неё
4. Ввести код из таблицы выше (например: `111111`)
5. Нажать кнопку "Войти"

> ⚠️ **НЕ нажимайте "Получить код"** — это создаст новый временный код и постоянный перестанет работать до пересоздания.

**Коды многоразовые** — можно входить и выходить сколько угодно раз.

### 1.3 Роли и доступы

| Роль | Доступные разделы |
|------|-------------------|
| client | Каталог, Избранное, Сравнение, Профиль, Бронирование |
| agent | + Подборки, CRM Клиенты |
| agency_admin | + Управление агентами агентства |
| admin | Полный доступ ко всем разделам |

### 1.4 Тестовые данные
- Минимум 3 активных объявления (offers) в базе
- Минимум 1 ЖК (complex) с объявлениями
- Тестовый share_code подборки (создать через агента)

---

## 2. Публичные страницы (без авторизации)

### 2.1 Главная страница `/`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть главную | Страница загружается, виден Header с логотипом HOUSLER |
| 2 | Проверить навигацию | Ссылки: Квартиры, Жилые комплексы, Карта, Войти |
| 3 | Кликнуть "Квартиры" | Переход на /offers |

### 2.2 Каталог квартир `/offers`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /offers | Список квартир загружается |
| 2 | Проверить фильтры | Фильтры работают: комнаты, цена, площадь, район |
| 3 | Применить фильтр "2 комнаты" | Отображаются только 2-комнатные |
| 4 | Сбросить фильтры | Отображаются все квартиры |
| 5 | Кликнуть на карточку | Переход на /offers/[id] |

### 2.3 Карточка объекта `/offers/[id]`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть карточку объекта | Страница загружается с фото, ценой, характеристиками |
| 2 | Проверить галерею | Фото листаются |
| 3 | Проверить ипотечный калькулятор | Калькулятор отображается, расчёт работает |
| 4 | **Форма бронирования (неавторизован)** | Форма ЗАБЛЮРЕНА с оверлеем "Войти" |
| 5 | Кликнуть "Войти" на оверлее | Переход на /login |

### 2.4 ЖК `/complexes`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /complexes | Список ЖК загружается |
| 2 | Кликнуть на ЖК | Переход на /complexes/[id] |
| 3 | Проверить страницу ЖК | Информация о ЖК + список квартир |

### 2.5 Карта `/map`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /map | Карта Яндекс загружается |
| 2 | Проверить маркеры | Маркеры ЖК отображаются |
| 3 | Кликнуть на маркер | Открывается попап с информацией |

### 2.6 Публичная подборка `/s/[code]`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /s/[share_code] | Подборка загружается |
| 2 | Проверить список объектов | Объекты отображаются с ценами |
| 3 | Кликнуть на объект | Открывается карточка объекта |
| 4 | Проверить счётчик просмотров | view_count увеличивается (проверить в БД) |

---

## 3. Авторизация

### 3.1 Вход `/login`
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /login | Форма с полем email |
| 2 | Ввести email и отправить | Отправляется код, форма переключается на ввод кода |
| 3 | Ввести неверный код | Ошибка "Неверный код" |
| 4 | Ввести верный код | Авторизация успешна, редирект на / |
| 5 | Проверить Header | Вместо "Войти" — аватар с именем/email |

### 3.2 Выход
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Перейти в /profile | Страница профиля |
| 2 | Нажать "Выйти" | Выход, редирект на / |
| 3 | Проверить Header | Снова кнопка "Войти" |

---

## 4. Привязка к агентству (ref-параметр)

### 4.1 Захват ref из URL
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /offers?ref=test-agency | Страница загружается |
| 2 | Открыть DevTools → Application → Local Storage | Ключ `housler_agency_ref` = "test-agency" |
| 3 | Авторизоваться как client | Клиент привязывается к агентству |
| 4 | Открыть /profile | В разделе "Мои агентства" отображается агентство |

---

## 5. Профиль клиента `/profile`

### 5.1 Страница профиля (роль: client)
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Авторизоваться как client | Успех |
| 2 | Перейти в /profile | Страница профиля загружается |
| 3 | Проверить шапку | Имя/email пользователя |
| 4 | Проверить быстрые ссылки | Избранное, Поиск, Сравнение |
| 5 | Проверить "Подборки от агентов" | Список подборок где client_email совпадает |
| 6 | Кликнуть на подборку | Переход на /s/[code] |

---

## 6. Избранное `/favorites`

### 6.1 Работа с избранным (авторизован)
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /offers | Каталог |
| 2 | Нажать сердечко на карточке | Добавлено в избранное, иконка заполнена |
| 3 | Открыть /favorites | Объект в списке избранного |
| 4 | Удалить из избранного | Объект исчезает |

---

## 7. Сравнение `/compare`

### 7.1 Работа со сравнением
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть /offers | Каталог |
| 2 | Нажать "Сравнить" на 2-3 карточках | Появляется плавающая панель снизу |
| 3 | Открыть /compare | Таблица сравнения объектов |
| 4 | Проверить параметры | Цена, площадь, этаж, ЖК сравниваются |

---

## 8. Подборки агента `/selections`

### 8.1 Список подборок (роль: agent)
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Авторизоваться как agent | Успех |
| 2 | Перейти в /selections | Список подборок агента |
| 3 | Проверить статистику | view_count, last_viewed_at отображаются |

### 8.2 Создание подборки
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Нажать "Создать подборку" | Модальное окно |
| 2 | Заполнить: название, имя клиента, email | Поля заполнены |
| 3 | Нажать "Создать" | Подборка создана, в списке |
| 4 | Открыть подборку | /selections/[id] открывается |

### 8.3 Добавление объектов в подборку
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Перейти в /offers | Каталог |
| 2 | Нажать "В подборку" на карточке | Выбор подборки |
| 3 | Выбрать подборку | Объект добавлен |
| 4 | Вернуться в подборку | Объект в списке |

### 8.4 Шаринг подборки
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть подборку | Страница подборки |
| 2 | Нажать "Поделиться" | Модальное окно со ссылкой |
| 3 | Скопировать ссылку | Ссылка в буфере |
| 4 | Открыть ссылку в инкогнито | Публичная подборка открывается |

### 8.5 Лог активности
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть подборку в инкогнито | Просмотр записывается |
| 2 | Вернуться в агентский аккаунт | /selections/[id] |
| 3 | Проверить лог активности | "Просмотр" с датой/временем |

---

## 9. CRM Клиенты `/clients`

### 9.1 Список клиентов (роль: agent)
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Перейти в /clients | Список клиентов |
| 2 | Проверить фильтры | По стадии, приоритету |

### 9.2 Создание клиента
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Нажать "Добавить клиента" | /clients/new |
| 2 | Заполнить форму | Имя, телефон, email |
| 3 | Сохранить | Клиент создан |

### 9.3 Воронка продаж
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Перейти в /clients/funnel | Канбан-доска по стадиям |
| 2 | Перетащить клиента | Стадия меняется |

---

## 10. Форма бронирования

### 10.1 Бронирование (авторизован)
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть карточку объекта | /offers/[id] |
| 2 | Развернуть форму бронирования | Форма с полями |
| 3 | Проверить предзаполнение | Имя, телефон, email из профиля |
| 4 | Отправить заявку | "Заявка отправлена!" |

### 10.2 Бронирование (неавторизован)
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть карточку объекта | /offers/[id] |
| 2 | Проверить форму бронирования | ЗАБЛЮРЕНА с оверлеем "Войти" |
| 3 | Нажать "Войти" | Переход на /login |

---

## 11. API тестирование (Postman)

### 11.1 Публичные эндпоинты
| Эндпоинт | Метод | Ожидаемый статус |
|----------|-------|------------------|
| /api/offers | GET | 200 |
| /api/offers/:id | GET | 200 |
| /api/complexes | GET | 200 |
| /api/complexes/:id | GET | 200 |
| /api/filters | GET | 200 |
| /api/selections/shared/:code | GET | 200 |

### 11.2 Авторизованные эндпоинты (с JWT)
| Эндпоинт | Метод | Роль | Ожидаемый статус |
|----------|-------|------|------------------|
| /api/favorites | GET | любая | 200 |
| /api/favorites/:offerId | POST | любая | 200/201 |
| /api/favorites/:offerId | DELETE | любая | 200 |
| /api/selections | GET | agent | 200 |
| /api/selections | POST | agent | 201 |
| /api/selections/my | GET | client | 200 |
| /api/clients | GET | agent | 200 |
| /api/clients | POST | agent | 201 |
| /api/agencies | GET | любая | 200 |
| /api/agencies/:slug/link | POST | client | 200 |

### 11.3 Ошибки авторизации
| Эндпоинт | Без токена | Неверный токен | Неверная роль |
|----------|------------|----------------|---------------|
| /api/selections | 401 | 401 | 403 |
| /api/clients | 401 | 401 | 403 |

---

## 12. Мобильная версия

### 12.1 Адаптивность
| Страница | Проверка |
|----------|----------|
| /offers | Карточки в 1 колонку, фильтры сворачиваются |
| /offers/[id] | Галерея адаптивна, форма на всю ширину |
| /map | Карта на весь экран |
| Header | Бургер-меню работает |

---

## 13. Известные проблемы / Особенности

1. **POST /api/selections возвращает 405** — проверить что токен с ролью agent/admin
2. **404 на favorites/:offerId** — нужен валидный offerId существующего объекта
3. **История цен** — отображается только если есть данные в price_history

---

## 14. Чеклист перед релизом

- [ ] Все публичные страницы открываются
- [ ] Авторизация по email+код работает
- [ ] Избранное синхронизируется
- [ ] Подборки создаются и шарятся
- [ ] Форма бронирования заблюрена для неавторизованных
- [ ] ref-параметр захватывается
- [ ] Профиль клиента отображает подборки
- [ ] CRM клиенты работают
- [ ] API возвращает корректные статусы
- [ ] Мобильная версия адаптивна
